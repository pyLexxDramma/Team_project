# Team_project
Командный проект по курсу «Профессиональная работа с Python» 

# VKinder Bot - Документация

## Описание

VKinder Bot - это бот для социальной сети VK, который помогает пользователям находить новых знакомых, основываясь на заданных критериях (город, пол, возраст). Бот позволяет просматривать анкеты пользователей, добавлять их в избранное или в черный список.

## Функциональность

*   **Поиск пользователей:**
    *   Запрос у пользователя города, пола и возраста для поиска.
    *   Использование VK API для поиска пользователей по заданным критериям.
    *   Отображение результатов поиска в виде карусели.
*   **Просмотр анкет:**
    *   Отображение анкет пользователей (имя, описание, фото).
    *   Возможность пролистывать анкеты с помощью кнопки "Дальше".
*   **Избранное:**
    *   Добавление анкет в список избранных.
    *   Просмотр списка избранных.
*   **Черный список:**
    *   Добавление анкет в черный список (исключение из результатов поиска).
*   **Сохранение данных в базе данных:**
    *   Сохранение информации о пользователях в базе данных (PostgreSQL).
    *   Сохранение связей между пользователями и их избранными/черным списком.
*   **Автоматическое управление токенами:**
    *   Автоматическое получение и обновление токенов VK API.
*   **Управление состоянием (FSM):**
    *   Использование конечных автоматов для управления состоянием диалога с пользователем.

## Архитектура

Бот состоит из следующих основных компонентов:

1.  **VK API:** Используется для взаимодействия с социальной сетью VK (получение информации о пользователях, отправка сообщений).
2.  **База данных (PostgreSQL):** Используется для хранения информации о пользователях, их избранных и черном списке.
3.  **Long Poll API:** Используется для получения событий от VK (новые сообщения).
4.  **VKinder Bot:** Основной модуль бота, который обрабатывает события, взаимодействует с VK API и базой данных.
5.  **Модули:**
    *   `create_keyboard`: Создание клавиатур для бота.
    *   `BD_tokens`: Управление токенами доступа к VK API.
    *   `config`: Хранение настроек бота (токены, ID групп и т.д.).
    *   `VKinder_db`: Создание структуры базы данных и взаимодействие с ней.
    *   `models`: Определение моделей SQLAlchemy для работы с базой данных.

## Модули и компоненты

*   **`bot.py` (Основной файл)**
    *   Инициализация VK API.
    *   Инициализация базы данных.
    *   Обработка событий (Long Poll).
    *   Управление состоянием пользователей (FSM).
    *   Обработка команд пользователя.
    *   Вызов функций для взаимодействия с VK API и базой данных.

*   **`create_keyboard/create_keyboard.py`**
    *   Создание клавиатур для бота (кнопки "Начать", "Дальше", выбор пола, города и т.д.).
    *   Использование библиотеки `vk_api.keyboard` для создания клавиатур.

*   **`BD_tokens/BD_tokens.py`**
    *   Получение токена доступа к VK API.
    *   Проверка срока действия токена.
    *   Обновление токена при необходимости.
    *   Использование Selenium для автоматического получения токена.

*   **`config/config.py`**
    *   Хранение настроек бота (токен группы VK, ID группы VK, ID приложения VK и т.д.).
    *   Использование переменных окружения или файла конфигурации для хранения настроек.

*   **`VKinder_db/create_db.py`**
    *   Создание структуры базы данных (таблицы Users, Blacklist, Favourites и т.д.).
    *   Функции для подключения к базе данных.
    *   Использование SQLAlchemy для взаимодействия с базой данных.
    *   Включение каскадного удаления для обеспечения целостности данных.

*   **`VKinder_db/models.py`**
    *   Определение моделей SQLAlchemy для работы с таблицами базы данных (User, Blacklist, Favourite и т.д.).
    *   Определение отношений между таблицами (ForeignKey, relationship).

## Схема базы данных

*   **`Users`:**
    *   `id` (INTEGER, PRIMARY KEY)
    *   `vk_id` (INTEGER)
    *   `first_name` (VARCHAR(20))
    *   `age` (INTEGER)
    *   `sex` (VARCHAR(10))
    *   `city` (VARCHAR(50))
*   **`Blacklist`:**
    *   `user_id` (INTEGER, FOREIGN KEY references Users.id, PRIMARY KEY)
    *   `blacklisted_user_id` (INTEGER, PRIMARY KEY)
*   **`Favourite`:**
    *   `user_id` (INTEGER, FOREIGN KEY references Users.id, PRIMARY KEY)
    *   `favorite_user_id` (INTEGER, PRIMARY KEY)

## Зависимости

*   `vk_api`
*   `vk_api.longpoll`
*   `vk_api.utils`
*   `vk_api.keyboard`
*   `psycopg2`
*   `SQLAlchemy`
*   `requests`
*   `lru_cache`
*   `scikit-learn` (sklearn)
*   `requests`
*   `Selenium` (для получения токена)

## Настройка и запуск

1.  **Клонируйте репозиторий:**

    ```bash
    git clone <URL_репозитория>
    cd <имя_репозитория>
    ```

2.  **Установите зависимости:**

    ```bash
    pip install -r requirements.txt
    ```

3.  **Настройте параметры бота:**

    *   Создайте файл `config/config.py` и заполните его необходимыми настройками (токен группы VK, ID группы VK, ID приложения VK, данные для подключения к базе данных и т.д.).
    *   Используйте переменные окружения для хранения конфиденциальных данных (токены, пароли).

4.  **Настройте базу данных:**

    *   Установите PostgreSQL.
    *   Создайте базу данных для бота.
    *   Укажите параметры подключения к базе данных в файле `config/config.py`.
    *   Запустите скрипт `VKinder_db/create_db.py` для создания структуры базы данных.

5.  **Запустите бота:**

    ```bash
    python bot.py
    ```

## Использование

1.  Запустите бота.
2.  Откройте VK и найдите группу бота.
3.  Отправьте боту команду "Начать".
4.  Следуйте инструкциям бота, отвечая на вопросы о городе, поле и возрасте.
5.  Просматривайте анкеты, добавляйте пользователей в избранное или черный список.

## Команды

*   `Начать`: Начать поиск пользователей.
*   `Дальше`: Просмотреть следующую анкету.
*   `Избранное`: Добавить текущую анкету в избранное.
*   `Черный список`: Добавить текущую анкету в черный список.
*   `Список избранных`: Показать список избранных пользователей.

## Замечания по реализации

*   Используется Long Poll API для получения событий от VK.
*   Для работы с базой данных используется SQLAlchemy.
*   Логирование используется для отслеживания ошибок и отладки.
*   Для получения токена доступа к VK API используется библиотека Selenium.
*   FSM используется для управления состоянием диалога с пользователем.
*   Для создания карусели необходимо загружать фотографии пользователей на сервер VK и получать `image_id`.




